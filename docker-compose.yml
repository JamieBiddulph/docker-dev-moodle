version: '3.2'
services: 
    
    mysql38:
        image: mysql:5.7
        command: --default-authentication-plugin=mysql_native_password
        environment: 
            MYSQL_ROOT_PASSWORD: mypassword
            MYSQL_DATABASE: moodle
        networks: 
            - overlay
        volumes: 
        # sql file for import
            - ./moodle.sql:/docker-entrypoint-initdb.d/moodle.sql

    webapp38:
        image: htmservice/moodle38:4.20200713
        ports:
            - "8038:80"
        networks:
            - overlay
        command: bash -c "a2dismod ssl && service apache2 restart && mkdir -p /var/www/moodledata && chmod 777 /var/www/moodledata && chown www-data:www-data /var/www/moodledata && /etc/init.d/cron start && tail -f /var/log/apache2/access.log"


        volumes: 
        # include additional plugins here if needed
        - ./config.php:/var/www/html/config.php
        - ./course-backups:/var/www/moodledata/repository/course-backups

    adminer:
        image: adminer
        ports:
            - 8083:8080
        networks: 
            - overlay
volumes: 
    db-data:


networks: 
    overlay:
